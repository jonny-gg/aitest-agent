# C/C++ æµ‹è¯•ç”Ÿæˆå¢å¼ºåŠŸèƒ½

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è®°å½•äº† C/C++ æµ‹è¯•ç”ŸæˆåŠŸèƒ½çš„é‡å¤§æ”¹è¿›ï¼Œä½¿å…¶è¾¾åˆ°ä¸ Go è¯­è¨€æµ‹è¯•ç”ŸæˆåŒç­‰çš„è´¨é‡æ°´å¹³ã€‚

## âœ¨ ä¸»è¦å¢å¼ºåŠŸèƒ½

### 1. æ™ºèƒ½æµ‹è¯•ç”¨ä¾‹ç­–ç•¥æ”¯æŒ â­

#### å®ç°ä½ç½®
- `backend/app/services/test_generator.py`
  - `CppTestGenerator.generate_tests_for_file()` (è¡Œ 2070-2123)
  - `CTestGenerator.generate_tests_for_file()` (è¡Œ 2409-2462)

#### åŠŸèƒ½ç‰¹æ€§

**è‡ªåŠ¨ä»£ç å¤æ‚åº¦åˆ†æ**ï¼š
- è®¡ç®—å¯æ‰§è¡Œä»£ç è¡Œæ•°ï¼ˆæ’é™¤æ³¨é‡Šã€ç©ºè¡Œï¼‰
- è®¡ç®—åœˆå¤æ‚åº¦
- æ ¹æ®å¤æ‚åº¦æ™ºèƒ½å†³å®šæµ‹è¯•ç”¨ä¾‹æ•°é‡

**æµ‹è¯•ç”¨ä¾‹æ•°é‡ç­–ç•¥**ï¼š
- ç®€å•å‡½æ•°ï¼ˆ< 10è¡Œï¼‰ï¼š2-3 ä¸ªæµ‹è¯•ç”¨ä¾‹
- ä¸­ç­‰å‡½æ•°ï¼ˆ10-30è¡Œï¼‰ï¼š4-6 ä¸ªæµ‹è¯•ç”¨ä¾‹
- å¤æ‚å‡½æ•°ï¼ˆ30-50è¡Œï¼‰ï¼š7-10 ä¸ªæµ‹è¯•ç”¨ä¾‹
- è¶…å¤æ‚å‡½æ•°ï¼ˆ> 50è¡Œï¼‰ï¼š11-15 ä¸ªæµ‹è¯•ç”¨ä¾‹

**æ™ºèƒ½åœºæ™¯åˆ†é…**ï¼š
- âœ… æ­£å¸¸åœºæ™¯ï¼š40%
- âš ï¸  è¾¹ç•Œåœºæ™¯ï¼š30%
- âŒ å¼‚å¸¸åœºæ™¯ï¼š30%

#### ä½¿ç”¨ç¤ºä¾‹

```python
# è‡ªåŠ¨åº”ç”¨æ™ºèƒ½ç­–ç•¥
cpp_generator = CppTestGenerator(client, "gpt-4", "openai")
file_analysis = {
    'file_path': 'calculator.cpp',
    'functions': [
        {
            'name': 'add',
            'body': '...',
            'executable_lines': 5,
            'complexity': 1
        },
        {
            'name': 'complexCalculation',
            'body': '...',
            'executable_lines': 45,
            'complexity': 12
        }
    ]
}

# ä¼šä¸º add() ç”Ÿæˆ 2 ä¸ªæµ‹è¯•ï¼Œä¸º complexCalculation() ç”Ÿæˆ 10 ä¸ªæµ‹è¯•
test_code = cpp_generator.generate_tests_for_file(file_analysis, "cpp", "google_test")
```

#### æ—¥å¿—è¾“å‡ºç¤ºä¾‹

```
ğŸ“Š C++ æ–‡ä»¶æµ‹è¯•ç­–ç•¥:
   æ€»æµ‹è¯•ç”¨ä¾‹: 12 ä¸ª
   å‡½æ•°æ•°é‡: 2 ä¸ª
   add: 2 ä¸ªæµ‹è¯•ç”¨ä¾‹ (æ­£å¸¸:1, è¾¹ç•Œ:1, å¼‚å¸¸:0)
   complexCalculation: 10 ä¸ªæµ‹è¯•ç”¨ä¾‹ (æ­£å¸¸:4, è¾¹ç•Œ:3, å¼‚å¸¸:3)
```

---

### 2. å¢å¼ºçš„ Prompt æ¨¡æ¿ ğŸ“

#### å®ç°ä½ç½®
- `backend/app/services/prompt_templates.py`
  - `cpp_google_test_with_strategy()` (è¡Œ 1063-1305)
  - `c_unit_test_with_strategy()` (è¡Œ 1365-1612)

#### C++ Prompt æ¨¡æ¿ç‰¹æ€§

**åŒ…å«å†…å®¹**ï¼š
1. **æ™ºèƒ½æµ‹è¯•ç­–ç•¥è¯´æ˜**
   - æ˜¾ç¤ºä»£ç å¤æ‚åº¦åˆ†æç»“æœ
   - æ˜ç¡®æµ‹è¯•ç”¨ä¾‹æ•°é‡è¦æ±‚
   - åœºæ™¯åˆ†é…è¯¦æƒ…

2. **è¯¦ç»†æ¡†æ¶è¯´æ˜**
   - Google Test / Catch2 åŸºæœ¬ç»“æ„
   - å¸¸ç”¨æ–­è¨€å®å®Œæ•´åˆ—è¡¨
   - EXPECT vs ASSERT çš„åŒºåˆ«

3. **æµ‹è¯•è®¾è®¡åŸåˆ™**
   - AAA æ¨¡å¼ï¼ˆArrange-Act-Assertï¼‰è¯¦è§£
   - æ­£å¸¸/è¾¹ç•Œ/å¼‚å¸¸åœºæ™¯åˆ†ç±»æŒ‡å¯¼
   - å…·ä½“ç¤ºä¾‹

4. **C++ æœ€ä½³å®è·µ**
   - å†…å­˜ç®¡ç†ï¼ˆæ™ºèƒ½æŒ‡é’ˆã€RAIIï¼‰
   - å¼‚å¸¸å®‰å…¨
   - ç±»å‹å®‰å…¨
   - æµ‹è¯•ç‹¬ç«‹æ€§

5. **å‘½åè§„èŒƒ**
   - æµ‹è¯•å¥—ä»¶å‘½åè§„åˆ™
   - æµ‹è¯•ç”¨ä¾‹æè¿°æ€§å‘½å
   - å¥½/åå‘½åå¯¹æ¯”ç¤ºä¾‹

6. **ä»£ç é£æ ¼è¦æ±‚**
   - ç¼©è¿›è§„åˆ™
   - å¤§æ‹¬å·é£æ ¼
   - å‘½åçº¦å®š

#### C Prompt æ¨¡æ¿ç‰¹æ€§

**ä¸“æ³¨äº C è¯­è¨€ç‰¹æ€§**ï¼š
- CUnit / Unity æ¡†æ¶è¯¦ç»†è¯´æ˜
- NULL æŒ‡é’ˆå¤„ç†
- å†…å­˜ç®¡ç†æµ‹è¯•
- æŒ‡é’ˆå®‰å…¨éªŒè¯
- å­—ç¬¦ä¸²å¤„ç†æµ‹è¯•
- é”™è¯¯ç æ£€æŸ¥

#### å¯¹æ¯”ï¼šPrompt è´¨é‡æå‡

| æ–¹é¢ | æ—§ç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ |
|------|--------|--------|
| é•¿åº¦ | ~30 è¡Œ | ~250 è¡Œ |
| æµ‹è¯•ç­–ç•¥ | âŒ æ—  | âœ… æ™ºèƒ½ç­–ç•¥ |
| æ¡†æ¶è¯´æ˜ | âš ï¸  ç®€å• | âœ… è¯¦ç»†+ç¤ºä¾‹ |
| æœ€ä½³å®è·µ | âŒ æ—  | âœ… å®Œæ•´æŒ‡å— |
| ç¤ºä¾‹ä»£ç  | âš ï¸  1ä¸ª | âœ… å¤šä¸ªåœºæ™¯ |
| å‘½åè§„èŒƒ | âŒ æ—  | âœ… è¯¦ç»†è¯´æ˜ |

---

### 3. å¢å¼ºçš„ä»£ç åˆ†æå™¨ ğŸ”

#### C++ åˆ†æå™¨å¢å¼º

**å®ç°ä½ç½®**ï¼š`backend/app/services/code_analyzer.py` (è¡Œ 270-572)

**æ–°å¢åŠŸèƒ½**ï¼š

1. **å‘½åç©ºé—´æ”¯æŒ**
   ```cpp
   namespace utils {
       namespace math {
           int add(int a, int b) { return a + b; }
       }
   }
   ```
   - é€’å½’éå†å‘½åç©ºé—´
   - å®Œæ•´å‘½åç©ºé—´è·¯å¾„è®°å½•
   - å‡½æ•°å½’å±äºæ­£ç¡®çš„å‘½åç©ºé—´

2. **æ¨¡æ¿æ£€æµ‹**
   ```cpp
   template<typename T>
   T max(T a, T b) { return (a > b) ? a : b; }
   ```
   - è¯†åˆ«æ¨¡æ¿å£°æ˜
   - æ ‡è®°æ¨¡æ¿å‡½æ•°/ç±»

3. **ç±»å’Œç»§æ‰¿åˆ†æ**
   ```cpp
   class Derived : public Base {
       // ...
   };
   ```
   - æå–åŸºç±»ä¿¡æ¯
   - åŒºåˆ† class å’Œ struct
   - ç±»å†…æ–¹æ³•æå–

4. **è¯¦ç»†å‚æ•°æå–**
   ```cpp
   void process(int count, const std::string& name, double* values)
   ```
   - å®Œæ•´å‚æ•°ç±»å‹
   - å‚æ•°åç§°
   - å¼•ç”¨/æŒ‡é’ˆæ ‡è¯†

5. **è¿”å›ç±»å‹æå–**
   ```cpp
   std::vector<int> getNumbers()
   std::shared_ptr<Data> getData()
   ```
   - å®Œæ•´è¿”å›ç±»å‹
   - æ¨¡æ¿ç±»å‹æ”¯æŒ

**åˆ†æç»“æœç¤ºä¾‹**ï¼š

```python
{
    'file_path': 'utils.cpp',
    'functions': [
        {
            'name': 'calculateSum',
            'type': 'function',
            'namespace': 'utils::math',
            'params': ['int a', 'int b'],
            'return_type': 'int',
            'body': '{ return a + b; }',
            'executable_lines': 1,
            'complexity': 1,
            'is_template': False
        }
    ],
    'classes': [
        {
            'name': 'Calculator',
            'type': 'class',
            'namespace': 'utils',
            'base_classes': ['BaseCalculator']
        }
    ],
    'namespaces': [
        {'name': 'utils'},
        {'name': 'utils::math'}
    ]
}
```

#### C åˆ†æå™¨å¢å¼º

**å®ç°ä½ç½®**ï¼š`backend/app/services/code_analyzer.py` (è¡Œ 575-768)

**æ–°å¢åŠŸèƒ½**ï¼š

1. **ç»“æ„ä½“åˆ†æ**
   ```c
   struct Person {
       char name[50];
       int age;
   };
   ```
   - ç»“æ„ä½“åç§°æå–
   - å­—æ®µåˆ—è¡¨

2. **è¯¦ç»†å‚æ•°æå–**
   ```c
   int process(const char* input, int* output, size_t len)
   ```
   - å‚æ•°ç±»å‹ï¼ˆåŒ…æ‹¬æŒ‡é’ˆã€constï¼‰
   - å‚æ•°åç§°

3. **è¿”å›ç±»å‹æå–**
   ```c
   char* getString(void)
   ```
   - å®Œæ•´è¿”å›ç±»å‹ï¼ˆåŒ…æ‹¬æŒ‡é’ˆï¼‰

---

## ğŸ”„ ä»£ç ç‹¬ç«‹æ€§ä¿è¯

### ä¸‰ç§è¯­è¨€å®Œå…¨éš”ç¦»

æ¯ç§è¯­è¨€çš„æµ‹è¯•ç”Ÿæˆå™¨éƒ½æ˜¯ç‹¬ç«‹çš„ç±»ï¼Œä¸å…±äº«çŠ¶æ€ï¼š

```
TestGenerator (åŸºç±»)
â”œâ”€â”€ GolangTestGenerator
â”‚   â”œâ”€â”€ _build_prompt()           # Go ä¸“ç”¨
â”‚   â”œâ”€â”€ _extract_code_block()     # Go ä¸“ç”¨
â”‚   â””â”€â”€ _ensure_ginkgo_suite_template()  # Go ä¸“ç”¨
â”‚
â”œâ”€â”€ CppTestGenerator
â”‚   â”œâ”€â”€ _build_prompt()           # C++ ä¸“ç”¨
â”‚   â”œâ”€â”€ _extract_code_block()     # C++ ä¸“ç”¨
â”‚   â””â”€â”€ _merge_test_codes()       # C++ ä¸“ç”¨
â”‚
â””â”€â”€ CTestGenerator
    â”œâ”€â”€ _build_prompt()           # C ä¸“ç”¨
    â”œâ”€â”€ _extract_code_block()     # C ä¸“ç”¨
    â””â”€â”€ _merge_test_codes()       # C ä¸“ç”¨
```

**éš”ç¦»ä¿è¯**ï¼š
- âœ… æ¯ä¸ªç±»æœ‰è‡ªå·±çš„ç§æœ‰æ–¹æ³•
- âœ… æ²¡æœ‰å…±äº«çš„ç±»å˜é‡
- âœ… æ²¡æœ‰å…¨å±€çŠ¶æ€
- âœ… ç‹¬ç«‹çš„ Prompt æ¨¡æ¿
- âœ… ç‹¬ç«‹çš„ä»£ç åˆ†æå™¨

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”æ€»ç»“

| åŠŸèƒ½ç‰¹æ€§ | Go è¯­è¨€ | C++ (æ–°) | C (æ–°) |
|---------|---------|----------|--------|
| **åŸºç¡€æµ‹è¯•ç”Ÿæˆ** | âœ… | âœ… | âœ… |
| **æµ‹è¯•æ‰§è¡Œ** | âœ… | âœ… | âœ… |
| **è¦†ç›–ç‡æ”¶é›†** | âœ… | âœ… | âœ… |
| **æµ‹è¯•ä¿®å¤** | âœ… | âœ… | âœ… |
| **æ™ºèƒ½æµ‹è¯•ç”¨ä¾‹ç­–ç•¥** | âœ… | âœ… | âœ… |
| **è¯¦ç»† Prompt æ¨¡æ¿** | âœ… (200+ è¡Œ) | âœ… (250+ è¡Œ) | âœ… (250+ è¡Œ) |
| **ä»£ç å¤æ‚åº¦åˆ†æ** | âœ… | âœ… | âœ… |
| **å‚æ•°/è¿”å›ç±»å‹æå–** | âœ… | âœ… | âœ… |
| **å‘½åç©ºé—´æ”¯æŒ** | âœ… (package) | âœ… | N/A |
| **æ¨¡æ¿æ”¯æŒ** | âœ… (generics) | âœ… | N/A |
| **æ··åˆæ¨¡å¼ç”Ÿæˆ** | âœ… | âš ï¸  å¾…å®ç° | âš ï¸  å¾…å®ç° |
| **è‡ªåŠ¨æ¨¡å—è·¯å¾„æ£€æµ‹** | âœ… | N/A | N/A |

**ç»“è®º**ï¼šC/C++ ç°åœ¨å·²ç»è¾¾åˆ°ä¸ Go è¯­è¨€**åŒç­‰æ°´å¹³**çš„æ™ºèƒ½æµ‹è¯•ç”Ÿæˆèƒ½åŠ›ï¼

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### C++ é¡¹ç›®ç¤ºä¾‹

```json
{
  "name": "C++ Calculator Project",
  "git_url": "https://github.com/example/cpp-calculator",
  "language": "cpp",
  "test_framework": "google_test",
  "source_directory": "src",
  "test_directory": "tests",
  "coverage_threshold": 80.0,
  "auto_commit": true,
  "create_pr": true
}
```

**ç”Ÿæˆçš„æµ‹è¯•å°†åŒ…å«**ï¼š
- æ ¹æ®ä»£ç å¤æ‚åº¦æ™ºèƒ½åˆ†é…çš„æµ‹è¯•ç”¨ä¾‹æ•°é‡
- æ­£å¸¸/è¾¹ç•Œ/å¼‚å¸¸åœºæ™¯å…¨è¦†ç›–
- AAA æ¨¡å¼çš„æ¸…æ™°ç»“æ„
- æè¿°æ€§çš„æµ‹è¯•åç§°
- å®Œæ•´çš„æ–­è¨€

### C é¡¹ç›®ç¤ºä¾‹

```json
{
  "name": "C String Utilities",
  "git_url": "https://github.com/example/c-string-utils",
  "language": "c",
  "test_framework": "cunit",
  "source_directory": "src",
  "test_directory": "tests",
  "coverage_threshold": 75.0
}
```

**ç”Ÿæˆçš„æµ‹è¯•å°†åŒ…å«**ï¼š
- æ™ºèƒ½æµ‹è¯•ç”¨ä¾‹ç­–ç•¥
- NULL æŒ‡é’ˆå¤„ç†æµ‹è¯•
- å†…å­˜æ³„æ¼æ£€æµ‹
- ç¼“å†²åŒºè¾¹ç•Œæµ‹è¯•
- é”™è¯¯ç éªŒè¯

---

## ğŸ“ å¾…æ”¹è¿›äº‹é¡¹

è™½ç„¶å·²ç»è¾¾åˆ° Go è¯­è¨€çš„æ°´å¹³ï¼Œä½†ä»æœ‰æå‡ç©ºé—´ï¼š

1. **æ··åˆæ¨¡å¼ç”Ÿæˆ**
   - ç›®å‰åªæœ‰ Go æ”¯æŒ
   - å¯ä»¥è®© C/C++ ä¹Ÿæ”¯æŒåŸºäºç°æœ‰æµ‹è¯•ç”Ÿæˆæ–°æµ‹è¯•

2. **Mock æ¡†æ¶é›†æˆ**
   - Go æœ‰ gomock
   - C++ å¯ä»¥é›†æˆ Google Mock
   - C å¯ä»¥é›†æˆ CMock

3. **æµ‹è¯• Fixture è‡ªåŠ¨ç”Ÿæˆ**
   - è‡ªåŠ¨è¯†åˆ«éœ€è¦çš„ setup/teardown
   - èµ„æºç®¡ç†æ¨¡æ¿

4. **æ›´æ™ºèƒ½çš„æ¨¡æ¿æ£€æµ‹**
   - ç›®å‰çš„ C++ æ¨¡æ¿æ£€æµ‹è¾ƒç®€å•
   - å¯ä»¥æ›´å‡†ç¡®åœ°è¯†åˆ«æ¨¡æ¿ç‰¹åŒ–

---

## ğŸ¯ æ€»ç»“

é€šè¿‡è¿™æ¬¡é‡å¤§æ”¹è¿›ï¼ŒC/C++ æµ‹è¯•ç”ŸæˆåŠŸèƒ½å·²ç»ï¼š

âœ… **æ™ºèƒ½åŒ–**ï¼šæ ¹æ®ä»£ç å¤æ‚åº¦è‡ªåŠ¨è°ƒæ•´æµ‹è¯•ç­–ç•¥  
âœ… **ä¸“ä¸šåŒ–**ï¼šè¯¦ç»†çš„æµ‹è¯•æœ€ä½³å®è·µæŒ‡å¯¼  
âœ… **å®Œå–„åŒ–**ï¼šæ”¯æŒå‘½åç©ºé—´ã€æ¨¡æ¿ã€ç»§æ‰¿ç­‰é«˜çº§ç‰¹æ€§  
âœ… **ç‹¬ç«‹åŒ–**ï¼šä¸‰ç§è¯­è¨€å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å½±å“  
âœ… **è§„èŒƒåŒ–**ï¼šç»Ÿä¸€çš„æµ‹è¯•ä»£ç é£æ ¼å’Œå‘½åè§„èŒƒ  

ç°åœ¨ï¼ŒC/C++ å¼€å‘è€…å¯ä»¥äº«å—ä¸ Go å¼€å‘è€…åŒç­‰è´¨é‡çš„ AI æµ‹è¯•ç”Ÿæˆä½“éªŒï¼ğŸ‰

---

**ç‰ˆæœ¬**ï¼šv2.0  
**æ—¥æœŸ**ï¼š2025-10-30  
**ä½œè€…**ï¼šAI Test Agent Team

